<!doctype html>
<html>
<head>
  <meta charset="utf-8">
<title>MiniSearchEngine 项目 | 落枫的博客</title>
<meta name="author" content="">

  <meta name="keywords" content="linux">


<link rel="shortcut icon" href="/public/upload/gavatar/favicon.ico" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/public/css/bootstrap.css">
<link rel="stylesheet" href="/public/css/font-awesome.css">
<link rel="stylesheet" href="/public/js/prettify/prettify.css">
<link rel="stylesheet" href="/public/css/base.css">
<!--<link href="/pages/atom.xml" rel="alternate" title="落枫的博客" type="application/atom+xml"> -->
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col-md-4 col-lg-4 col-sm-12 col-xs-12 aside visible-md visible-lg">
  <div class="row">
    <div class="col-md-3 col-xs-3 aside1">
      <br>
      <a class="pjaxlink" href="/"><img src="/public/upload/gavatar/gavatar.png" class="img-rounded avatar"></a>
      <br><br>
      <ul class="nav nav-pills nav-stacked">
        
          <li><a href="#学习" data-toggle="tab">学习</a></li>
        
          <li><a href="#技术学习" data-toggle="tab">技术学习</a></li>
        
          <li><a href="#面试必备" data-toggle="tab">面试必备</a></li>
        
        <li><a href="#tags" data-toggle="tab">标签</a></li>
        <!--        <li><a class="pjaxlink" href="/pages/about.html">关于</a></li>-->
      </ul>
      <div class="aside1_bottom">
        <!--
        <table class="table table-condensed">
          <tr>
            <td><a href="/pages/atom.xml" target="_blank"><i class="fa fa-rss fa-2x"></i></a></td>
            <td><a href="mailto:liuwenyu21@gmail.com"><i class="fa fa-envelope-o fa-2x"></i></a></td>
          </tr>
        </table>
      -->
        <!--
      <img src="" class="img-rounded weixin">
      -->
      </div>
    </div>
    <div class="col-md-9 col-xs-9 aside2">
      <div class="row">
        <div class="tab-content">
           
            <div class="tab-pane" id="学习">
              <div class="list-group">
                <h2 class="center">学习</h2>
                
                  <a href="/2014/06/16/%E9%93%BE%E8%A1%A8.html" class="list-group-item pjaxlink">二叉树 链表</a>
                
                  <a href="/2014/06/15/fork.html" class="list-group-item pjaxlink">多进程 fork</a>
                
                  <a href="/2014/06/14/sql.html" class="list-group-item pjaxlink">MySql</a>
                
                  <a href="/2014/06/13/%E6%8E%92%E5%BA%8F.html" class="list-group-item pjaxlink">排序 查找 键树 结构体</a>
                
                  <a href="/2014/06/10/%E9%87%8D%E8%BD%BD.html" class="list-group-item pjaxlink">重载 虚函数 动态绑定</a>
                
                  <a href="/2014/06/07/%E9%80%92%E5%BD%92.html" class="list-group-item pjaxlink">递归 宏定义 内联函数</a>
                
                  <a href="/2014/06/06/%E6%9E%9A%E4%B8%BE.html" class="list-group-item pjaxlink">枚举 sizeof</a>
                
                  <a href="/2014/06/04/%E8%81%94%E5%90%88%E4%BD%93.html" class="list-group-item pjaxlink">联合体 大端小端 位域 指针引用</a>
                
                  <a href="/2014/06/02/volatile.html" class="list-group-item pjaxlink">全局变量 volatile</a>
                
                  <a href="/2014/05/30/const%E4%B8%8E%E6%8C%87%E9%92%88.html" class="list-group-item pjaxlink">const与指针 函数返回值 声明</a>
                
                  <a href="/2014/05/20/gdb.html" class="list-group-item pjaxlink">GDB调试</a>
                
                  <a href="/2014/05/03/UDP%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B.html" class="list-group-item pjaxlink">UDP服务器 僵尸进程</a>
                
                  <a href="/2014/05/02/%E6%80%BB%E7%BB%93.html" class="list-group-item pjaxlink">学习总结</a>
                
                  <a href="/2014/05/01/%E8%99%9A%E7%BB%A7%E6%89%BF.html" class="list-group-item pjaxlink">约瑟夫问题 虚继承</a>
                
                  <a href="/2014/04/30/%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0.html" class="list-group-item pjaxlink">构造函数</a>
                
                  <a href="/2014/04/25/%E7%BA%BF%E7%A8%8B%E6%B1%A0.html" class="list-group-item pjaxlink">内存 线程池</a>
                
                  <a href="/2014/04/24/c++.html" class="list-group-item pjaxlink">c++</a>
                
                  <a href="/2014/04/23/%E5%86%85%E5%AD%98.html" class="list-group-item pjaxlink">内存 复制控制</a>
                
                  <a href="/2014/04/22/%E7%BB%A7%E6%89%BF.html" class="list-group-item pjaxlink">继承 函数重载覆盖隐藏</a>
                
                  <a href="/2014/04/21/string.html" class="list-group-item pjaxlink">重载运算符-智能指针-String</a>
                
                  <a href="/2014/04/18/%E5%A4%8D%E5%88%B6%E6%8E%A7%E5%88%B6.html" class="list-group-item pjaxlink">复制控制</a>
                
                  <a href="/2014/04/17/map.html" class="list-group-item pjaxlink">Linux网络编程 map</a>
                
                  <a href="/2014/04/16/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F.html" class="list-group-item pjaxlink">工厂模式</a>
                
                  <a href="/2014/04/15/UDP%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%94%9F%E4%BA%A7%E8%80%85.html" class="list-group-item pjaxlink">UDP服务器 生产者</a>
                
                  <a href="/2014/04/14/%E7%BA%BF%E7%A8%8B.html" class="list-group-item pjaxlink">线程</a>
                
                  <a href="/2014/04/11/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F.html" class="list-group-item pjaxlink">设计模式 单例模式</a>
                
                  <a href="/2014/04/09/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%A4%9A%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%AF%94%E8%BE%83.html" class="list-group-item pjaxlink">进程 线程</a>
                
                  <a href="/2014/04/04/Socket-TCP.html" class="list-group-item pjaxlink">Socket TCP</a>
                
                  <a href="/2014/04/03/linux(UDP).html" class="list-group-item pjaxlink">基于UDP的多人群聊</a>
                
                  <a href="/2014/04/02/Linux.html" class="list-group-item pjaxlink">Linux网络编程 socket UDP</a>
                
                  <a href="/2014/04/01/Linux.html" class="list-group-item pjaxlink">大端小端 ip转换</a>
                
                  <a href="/2014/03/31/pthread.html" class="list-group-item pjaxlink">pthread</a>
                
              </div>
            </div>
           
            <div class="tab-pane" id="技术学习">
              <div class="list-group">
                <h2 class="center">技术学习</h2>
                
                  <a href="/2014/06/19/%E5%9F%BA%E4%BA%8EHTTP%E5%8D%8F%E8%AE%AE%E7%9A%84%E7%9B%AE%E5%BD%95%E6%B5%8F%E8%A7%88%E5%92%8C%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%9C%8D%E5%8A%A1%E5%99%A8.html" class="list-group-item pjaxlink">FTP文件服务器 项目</a>
                
                  <a href="/2014/06/01/%E5%AD%A6%E4%B9%A0%E9%87%8D%E7%82%B9.html" class="list-group-item pjaxlink">学习方向与重点</a>
                
                  <a href="/2014/05/26/MiniSearchEngine%E6%80%BB%E7%BB%93.html" class="list-group-item pjaxlink">MiniSearchEngine总结</a>
                
                  <a href="/2014/05/24/minisearchengin.html" class="list-group-item pjaxlink">MiniSearchEngine 项目</a>
                
                  <a href="/2014/05/22/SpellCorrector.html" class="list-group-item pjaxlink">SpellCorrector 项目</a>
                
                  <a href="/2014/05/05/epoll%E8%AF%A6%E8%A7%A3.html" class="list-group-item pjaxlink">epoll</a>
                
                  <a href="/2014/05/02/mini%E6%90%9C%E7%B4%A2.html" class="list-group-item pjaxlink">mini搜索</a>
                
              </div>
            </div>
           
            <div class="tab-pane" id="面试必备">
              <div class="list-group">
                <h2 class="center">面试必备</h2>
                
                  <a href="/2014/06/20/c++300(1-180).html" class="list-group-item pjaxlink">c++笔试300题</a>
                
              </div>
            </div>
          
          <div class="tab-pane" id="tags">
            <div class="panel-group" id="accordion">
              <h2 class="center">标签</h2>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#linux">linux</a>
                      <span class="badge pull-right">37</span>
                    </h4>
                  </div>
                  <div id="linux" class="panel-collapse collapse">
                    
                      <a  href='/2014/06/19/%E5%9F%BA%E4%BA%8EHTTP%E5%8D%8F%E8%AE%AE%E7%9A%84%E7%9B%AE%E5%BD%95%E6%B5%8F%E8%A7%88%E5%92%8C%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%9C%8D%E5%8A%A1%E5%99%A8.html' class="list-group-item pjaxlink">
                        FTP文件服务器 项目
                      </a>
                    
                      <a  href='/2014/06/16/%E9%93%BE%E8%A1%A8.html' class="list-group-item pjaxlink">
                        二叉树 链表
                      </a>
                    
                      <a  href='/2014/06/15/fork.html' class="list-group-item pjaxlink">
                        多进程 fork
                      </a>
                    
                      <a  href='/2014/06/13/%E6%8E%92%E5%BA%8F.html' class="list-group-item pjaxlink">
                        排序 查找 键树 结构体
                      </a>
                    
                      <a  href='/2014/06/10/%E9%87%8D%E8%BD%BD.html' class="list-group-item pjaxlink">
                        重载 虚函数 动态绑定
                      </a>
                    
                      <a  href='/2014/06/07/%E9%80%92%E5%BD%92.html' class="list-group-item pjaxlink">
                        递归 宏定义 内联函数
                      </a>
                    
                      <a  href='/2014/06/06/%E6%9E%9A%E4%B8%BE.html' class="list-group-item pjaxlink">
                        枚举 sizeof
                      </a>
                    
                      <a  href='/2014/06/04/%E8%81%94%E5%90%88%E4%BD%93.html' class="list-group-item pjaxlink">
                        联合体 大端小端 位域 指针引用
                      </a>
                    
                      <a  href='/2014/06/02/volatile.html' class="list-group-item pjaxlink">
                        全局变量 volatile
                      </a>
                    
                      <a  href='/2014/06/01/%E5%AD%A6%E4%B9%A0%E9%87%8D%E7%82%B9.html' class="list-group-item pjaxlink">
                        学习方向与重点
                      </a>
                    
                      <a  href='/2014/05/30/const%E4%B8%8E%E6%8C%87%E9%92%88.html' class="list-group-item pjaxlink">
                        const与指针 函数返回值 声明
                      </a>
                    
                      <a  href='/2014/05/26/MiniSearchEngine%E6%80%BB%E7%BB%93.html' class="list-group-item pjaxlink">
                        MiniSearchEngine总结
                      </a>
                    
                      <a  href='/2014/05/24/minisearchengin.html' class="list-group-item pjaxlink">
                        MiniSearchEngine 项目
                      </a>
                    
                      <a  href='/2014/05/22/SpellCorrector.html' class="list-group-item pjaxlink">
                        SpellCorrector 项目
                      </a>
                    
                      <a  href='/2014/05/20/gdb.html' class="list-group-item pjaxlink">
                        GDB调试
                      </a>
                    
                      <a  href='/2014/05/05/epoll%E8%AF%A6%E8%A7%A3.html' class="list-group-item pjaxlink">
                        epoll
                      </a>
                    
                      <a  href='/2014/05/03/UDP%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B.html' class="list-group-item pjaxlink">
                        UDP服务器 僵尸进程
                      </a>
                    
                      <a  href='/2014/05/02/%E6%80%BB%E7%BB%93.html' class="list-group-item pjaxlink">
                        学习总结
                      </a>
                    
                      <a  href='/2014/05/02/mini%E6%90%9C%E7%B4%A2.html' class="list-group-item pjaxlink">
                        mini搜索
                      </a>
                    
                      <a  href='/2014/05/01/%E8%99%9A%E7%BB%A7%E6%89%BF.html' class="list-group-item pjaxlink">
                        约瑟夫问题 虚继承
                      </a>
                    
                      <a  href='/2014/04/30/%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0.html' class="list-group-item pjaxlink">
                        构造函数
                      </a>
                    
                      <a  href='/2014/04/25/%E7%BA%BF%E7%A8%8B%E6%B1%A0.html' class="list-group-item pjaxlink">
                        内存 线程池
                      </a>
                    
                      <a  href='/2014/04/24/c++.html' class="list-group-item pjaxlink">
                        c++
                      </a>
                    
                      <a  href='/2014/04/23/%E5%86%85%E5%AD%98.html' class="list-group-item pjaxlink">
                        内存 复制控制
                      </a>
                    
                      <a  href='/2014/04/22/%E7%BB%A7%E6%89%BF.html' class="list-group-item pjaxlink">
                        继承 函数重载覆盖隐藏
                      </a>
                    
                      <a  href='/2014/04/21/string.html' class="list-group-item pjaxlink">
                        重载运算符-智能指针-String
                      </a>
                    
                      <a  href='/2014/04/18/%E5%A4%8D%E5%88%B6%E6%8E%A7%E5%88%B6.html' class="list-group-item pjaxlink">
                        复制控制
                      </a>
                    
                      <a  href='/2014/04/17/map.html' class="list-group-item pjaxlink">
                        Linux网络编程 map
                      </a>
                    
                      <a  href='/2014/04/16/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F.html' class="list-group-item pjaxlink">
                        工厂模式
                      </a>
                    
                      <a  href='/2014/04/15/UDP%E6%9C%8D%E5%8A%A1%E5%99%A8-%E7%94%9F%E4%BA%A7%E8%80%85.html' class="list-group-item pjaxlink">
                        UDP服务器 生产者
                      </a>
                    
                      <a  href='/2014/04/14/%E7%BA%BF%E7%A8%8B.html' class="list-group-item pjaxlink">
                        线程
                      </a>
                    
                      <a  href='/2014/04/11/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F.html' class="list-group-item pjaxlink">
                        设计模式 单例模式
                      </a>
                    
                      <a  href='/2014/04/04/Socket-TCP.html' class="list-group-item pjaxlink">
                        Socket TCP
                      </a>
                    
                      <a  href='/2014/04/03/linux(UDP).html' class="list-group-item pjaxlink">
                        基于UDP的多人群聊
                      </a>
                    
                      <a  href='/2014/04/02/Linux.html' class="list-group-item pjaxlink">
                        Linux网络编程 socket UDP
                      </a>
                    
                      <a  href='/2014/04/01/Linux.html' class="list-group-item pjaxlink">
                        大端小端 ip转换
                      </a>
                    
                      <a  href='/2014/03/31/pthread.html' class="list-group-item pjaxlink">
                        pthread
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#总结">总结</a>
                      <span class="badge pull-right">1</span>
                    </h4>
                  </div>
                  <div id="总结" class="panel-collapse collapse">
                    
                      <a  href='/2014/04/09/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%A4%9A%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%AF%94%E8%BE%83.html' class="list-group-item pjaxlink">
                        进程 线程
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#MySql">MySql</a>
                      <span class="badge pull-right">1</span>
                    </h4>
                  </div>
                  <div id="MySql" class="panel-collapse collapse">
                    
                      <a  href='/2014/06/14/sql.html' class="list-group-item pjaxlink">
                        MySql
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#linux/C/C++">linux/C/C++</a>
                      <span class="badge pull-right">1</span>
                    </h4>
                  </div>
                  <div id="linux/C/C++" class="panel-collapse collapse">
                    
                      <a  href='/2014/06/20/c++300(1-180).html' class="list-group-item pjaxlink">
                        c++笔试300题
                      </a>
                    
                  </div>
                </div>
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

      <div class="col-md-8 col-lg-8 col-sm-12 col-xs-12 aside3">
        <div id="container">
          <div id="pjax">
            <div class="row">
  <div class="col-md-12 aside3-title">
    <br>
    <h2 id="#identifier">MiniSearchEngine 项目</h2>
    2014年05月24日
  </div>
  <div class="col-md-12 aside3-content">
    <hr>
    <div id="content">
      <p>标签（空格分隔）： MiniSearchEngine 项目</p>

<h2>第一阶段：搭建框架  0514</h2>

<h2>1.目录结构</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">bin        //存放可执行文件和执行脚本
conf       //配置文件, 包括服务器地址，网页库、网页库索引、单词索引、停用词表的路径等
data       //存放网页库、网页库索引、单词索引、停用词表
include    //存放头文件
log        //存放系统日志文件
src        //存放 cpp 代码文件
Makefile   //Makefile
</code></pre></div>
<h2>2.将服务器设置为守护进程</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">static void Daemon() {
    const int MAXFD = 64;
    if (fork() != 0)    //父进程退出
        exit(0);
    setsid();       //成为新进程组组长和新会话领导，脱离控制终端
    //chdir(&quot;/&quot;);   //此时目录不能改变，因为代码内文件路径是相对路径
    umask(0);       //重设文件访问权限掩码
    for (int i = 0; i &lt; MAXFD; i++) //尽可能关闭所有从父进程继承来的文件
            {
        if (i == 1) //关闭所有文件描述符，除了1，以便通过脚本运行时将输出流重定向至./log/log.txt
                {
            continue;
        }
        close(i);
    }
}
</code></pre></div>
<h2>3.封装tcp类</h2>

<h2>4.搭建多进程框架</h2>

<p>&emsp;&emsp;每当检测到客户端连接时，利用 <code>fork()</code> 生成一个子进程，让子进程去处理查询任务，并将查询结果发回客户端。
&emsp;&emsp;这里涉及到子进程的回收问题。若利用父进程的 <code>waitpid()</code> 回收，有可能造成父进程阻塞，不能及时处理新的访问，或者有可能产生僵尸进程，造成资源浪费。解决方法是：在 <code>fork()</code> 函数前设置 <code>signal(SIGCHLD, wait_child);</code> 或 <code>signal(SIGCHLD, SIG_IGN);</code>， 让系统接管子进程的回收。</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="k">static</span> <span class="kt">void</span> <span class="nf">wait_child</span><span class="p">(</span><span class="kt">int</span> <span class="n">pid</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">pid</span> <span class="o">=</span> <span class="n">waitpid</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">WNOHANG</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pid: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pid</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; exit!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">Daemon</span><span class="p">();</span> <span class="c1">//守护进程</span>

    <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">ifs</span><span class="p">(</span><span class="s">&quot;./conf/config.txt&quot;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">line</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="n">ifs</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">istringstream</span> <span class="n">iss</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
        <span class="n">iss</span> <span class="o">&gt;&gt;</span> <span class="n">conf</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">conf</span> <span class="o">==</span> <span class="s">&quot;address:&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">iss</span> <span class="o">&gt;&gt;</span> <span class="n">ip</span> <span class="o">&gt;&gt;</span> <span class="n">port</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">#ifndef DEBUG   </span><span class="c1">//输出ip和端口</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ip</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">port</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="cp">#endif</span>

    <span class="n">signal</span><span class="p">(</span><span class="n">SIGCHLD</span><span class="p">,</span> <span class="n">wait_child</span><span class="p">);</span> <span class="c1">//通过wait_child(int)函数来等待回收子进程退出后回收子进程的资源(也可使用下面这句语句回收子进程资源)</span>

    <span class="cm">/* 或单独使用下面的函数 */</span>
    <span class="c1">//signal(SIGCHLD, SIG_IGN); //父进程忽略子进程退出时传回的信号，让子进程结束的信号由系统接收，由1号进程负责回收子进程的资源</span>

    <span class="n">Task</span> <span class="n">task</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>   <span class="c1">//Task(最大显示的篇数，每篇显示的行数)</span>
    <span class="n">TcpSocket</span> <span class="n">mysocket</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">);</span>
<span class="cp">#ifndef DEBUG   </span><span class="c1">//打印标志信息</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;=== ready to recv message ===&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="k">while</span> <span class="p">(</span><span class="kt">int</span> <span class="n">client_fd</span> <span class="o">=</span> <span class="n">mysocket</span><span class="p">.</span><span class="n">accept_connection</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">//当检测到新的连接时，创建子进程来处理任务</span>
        <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="n">client_addr</span> <span class="o">=</span> <span class="n">mysocket</span><span class="p">.</span><span class="n">get_client_addr</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">fork</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>

                <span class="c1">//recv</span>
                <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">recv_buf</span><span class="p">;</span>
                <span class="n">mysocket</span><span class="p">.</span><span class="n">recv_message</span><span class="p">(</span><span class="n">client_fd</span><span class="p">,</span> <span class="n">recv_buf</span><span class="p">);</span>
                <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;recv:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">recv_buf</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">recv_buf</span> <span class="o">==</span> <span class="s">&quot;exit&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;client &quot;</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;ip: &quot;</span>
                            <span class="o">&lt;&lt;</span> <span class="n">inet_ntoa</span><span class="p">(</span><span class="n">client_addr</span><span class="p">.</span><span class="n">sin_addr</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span>
                            <span class="o">&lt;&lt;</span> <span class="n">ntohs</span><span class="p">(</span><span class="n">client_addr</span><span class="p">.</span><span class="n">sin_port</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; exit&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
                    <span class="n">close</span><span class="p">(</span><span class="n">client_fd</span><span class="p">);</span>
                    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="c1">//send</span>
                <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">send_buf</span><span class="p">;</span>
                <span class="n">send_buf</span> <span class="o">=</span> <span class="n">task</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">recv_buf</span><span class="p">));</span>
                <span class="n">mysocket</span><span class="p">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">client_fd</span><span class="p">,</span> <span class="n">send_buf</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">//close(client_fd);</span>
            <span class="c1">//waitpid(pid, NULL, WNOHANG);  //signal()之后不需要wait()</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>第二阶段：网页库构建    0515</h2>

<p>&emsp;&emsp;遍历目录读库文件，拼接成标准格式，然后写入文件，并同时建立库索引</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/* 
 * 网页库文件格式：
 * &lt;doc&gt;&lt;docid&gt;1&lt;/docid&gt;
 * &lt;url&gt;http://baidu.com/&lt;/url&gt;
 * &lt;title&gt;标题&lt;/title&gt;
 * &lt;content&gt;标题 + 内容&lt;/content&gt;&lt;/doc&gt;
 */
doc = &quot;&lt;doc&gt;&lt;docid&gt;&quot; + string(id)  + &quot;&lt;/docid&gt;&lt;url&gt;&quot; +
    string(entry-&gt;d_name) + &quot;&lt;/url&gt;&quot; + &quot;&lt;title&gt;&quot; + title +
    &quot;&lt;/title&gt;&lt;content&gt;&quot; + content  + &quot;&lt;/content&gt;&lt;/doc&gt;\n&quot;;
lib_vec.pushback(doc);  //每篇doc存入vector
</code></pre></div><div class="highlight"><pre><code class="language-c" data-lang="c"><span class="cm">/*</span>
<span class="cm"> * 写入网页库文件的同时，</span>
<span class="cm"> * 记录每篇doc的文件偏移量，和该篇doc的长度，</span>
<span class="cm"> * 写入库索引文件</span>
<span class="cm"> */</span>
<span class="k">for</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">lib_vec</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter</span> <span class="o">!=</span> <span class="n">lib_vec</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ofs_index</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ofs_lib</span><span class="p">.</span><span class="n">tellp</span><span class="p">();</span> 
        <span class="c1">//向index写入索引 docid，start_pos</span>
    <span class="n">ofs_lib</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">iter</span><span class="p">;</span>
        <span class="c1">//向lib写入doc内容</span>
    <span class="n">ofs_index</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="o">*</span><span class="n">iter</span><span class="p">).</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> 
        <span class="c1">//向index写入索引 size</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>第三阶段：网页去重  0516</h2>

<p>&emsp;&emsp;遍历网页库文件，分别取出每一篇doc，切词，去停用词后统计每篇doc的词频，放入优先级队列。从优先级队列中取出k个词频最高的单词，存入</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">doc_feature</span><span class="p">;</span>
 <span class="c1">//docid，     word， freq</span>
</code></pre></div>
<p>它可以代表每篇doc的特征。
&emsp;&emsp;然后开始去重：</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="c1">//去重</span>
<span class="kt">int</span> <span class="o">*</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">new</span> <span class="kt">int</span> <span class="p">[</span><span class="n">doc_feature</span><span class="p">.</span><span class="n">size</span><span class="p">()];</span>   <span class="c1">//构造一个数组</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">doc_feature</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>   <span class="c1">//给数组赋初始值</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">iter_end</span> <span class="o">=</span> <span class="n">doc_feature</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
<span class="n">iter_end</span><span class="o">--</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">iter_x</span> <span class="o">=</span> <span class="n">doc_feature</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter_x</span> <span class="o">!=</span> <span class="n">iter_end</span><span class="p">;</span> <span class="o">++</span><span class="n">iter_x</span><span class="p">)</span> <span class="c1">//待比较文章x</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//当前文章x已经被去除，跳过</span>
    <span class="p">{</span>
        <span class="n">iter_x</span> <span class="o">++</span><span class="p">;</span>
        <span class="n">ix</span> <span class="o">++</span><span class="p">;</span>
        <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">iter_y</span> <span class="o">=</span> <span class="n">iter_x</span><span class="p">;</span>
    <span class="n">iter_y</span><span class="o">++</span><span class="p">;</span>
    <span class="n">iy</span> <span class="o">=</span> <span class="n">ix</span><span class="p">;</span> <span class="n">iy</span><span class="o">++</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(;</span> <span class="n">iter_y</span> <span class="o">!=</span> <span class="n">doc_feature</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iter_y</span><span class="p">)</span> <span class="c1">//待比较文章y</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//当前文章y已经被去除，跳过</span>
        <span class="p">{</span>
            <span class="n">iter_y</span> <span class="o">++</span><span class="p">;</span>
            <span class="n">iy</span> <span class="o">++</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">compare_two_doc</span><span class="p">(</span><span class="n">iter_x</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">,</span> <span class="n">iter_y</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="c1">//重复</span>
        <span class="p">{</span>
<span class="cp">#ifndef NDEBUG  </span><span class="c1">//有重复时输出显示发生重复的两个docid和去除的docid</span>
            <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;repeat! &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iter_x</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">iter_y</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  trim &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">arr</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;  total(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">doc_feature</span><span class="p">.</span><span class="n">size</span><span class="p">()</span>  <span class="o">&lt;&lt;</span> <span class="s">&quot;)&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="cp">#endif</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    <span class="c1">//直接去除docid大的一篇</span>
        <span class="p">}</span>
        <span class="n">iy</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">ix</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//将去重数组写入文件</span>
<span class="n">string</span> <span class="n">outfile</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">string</span><span class="p">(</span><span class="s">&quot;_dup_arr.dat&quot;</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="n">dup_arr_file</span><span class="p">(</span><span class="n">outfile</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">doc_feature</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">dup_arr_file</span> <span class="o">&lt;&lt;</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">dup_arr_file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="n">delete</span> <span class="p">[]</span> <span class="n">arr</span><span class="p">;</span>
</code></pre></div>
<p>比较判断两篇 doc 是否重复的 top k 策略：</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="cm">/*</span>
<span class="cm"> * 比较两篇doc的词频最高的10个单词</span>
<span class="cm"> * 返回相似度</span>
<span class="cm"> * 即相同单词的个数</span>
<span class="cm"> * </span>
<span class="cm"> * 其他方法：</span>
<span class="cm"> *    将一个map插入另一个map</span>
<span class="cm"> *    每插入一个元素时</span>
<span class="cm"> *        如果相同则插入后size不变</span>
<span class="cm"> *        如果不同则size +1</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">compare_two_doc</span><span class="p">(</span><span class="k">const</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">mp1</span><span class="p">,</span> <span class="k">const</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">mp2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">count_dup</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">iter1</span> <span class="o">=</span> <span class="n">mp1</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter1</span> <span class="o">!=</span> <span class="n">mp1</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iter1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">iter2</span> <span class="o">=</span> <span class="n">mp2</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter2</span> <span class="o">!=</span> <span class="n">mp2</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iter2</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">iter1</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">==</span> <span class="n">iter2</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">)</span>
                <span class="n">count_dup</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">count_dup</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>根据以上去重方法得到的去重数组、和原来的网页库、网页库索引，建立新的网页库和网页库索引。重做新网页库的docid。</p>

<h2>第四阶段：建索引    0517</h2>

<h2>目标：</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">//单词  docid   归一化之后的权重
word1    docid   normalized_power    docid   normalized_power
word2   docid   normalized_power    ...
...
</code></pre></div>
<h2>第一步，根据公式求权重：</h2>

<p>$$
power<em>{word} = tf</em>{doc} * log(\frac{N}{df_{word}})
$$
```
power = tf * log(N/df); 
//power 该词在某一篇doc中的权重
//tf    该词在某一篇doc中的词频
//df    该词的文档频率
//N     文档总数</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">```c
/* 
 * 计算权重
 */
void compute_power(map&lt;string, map&lt;int, int&gt; &gt; &amp;word_docid_freq, map&lt;string, map&lt;int, double&gt; &gt; &amp;word_power)
{
    cout &lt;&lt; &quot;!!!!!!compute_power!!!!!!&quot; &lt;&lt; endl;
    for(map&lt;string, map&lt;int, int&gt; &gt;::iterator iter = word_docid_freq.begin(); iter != word_docid_freq.end(); ++iter)
        //遍历所有单词
    {
        string word = iter-&gt;first;
#ifndef DEBUG   //测试输出单词的权值
        //cout &lt;&lt; word &lt;&lt; &quot;: &quot; &lt;&lt; endl;
#endif
        for(map&lt;int, int&gt;::iterator it = word_docid_freq[word].begin(); it != word_docid_freq[word].end(); ++it)
            //遍历含有该单词的docid
        {
            int docid = it-&gt;first;
            int freq = it-&gt;second;
            word_power[word][docid] = freq*log(0.05 + (double)word_docid_freq.size()/(double)word_docid_freq[word].size());

#ifndef DEBUG   //测试输出单词的权值
            cout &lt;&lt; &quot;docid: &quot; &lt;&lt; docid &lt;&lt; &quot; power: &quot; &lt;&lt; word_power[word][docid] &lt;&lt; endl;
#endif
        }
    }
    cout &lt;&lt; &quot;compute over!!!&quot; &lt;&lt; endl;
}
</code></pre></div>
<h2>第二步，根据公式，把权重归一化：</h2>

<p>$$\begin{align}
normalized_power<em>{w1} = \frac{power</em>{w1}}{\sqrt{\sum<em>{i=1}^n (power</em>{wi})^2}}
\end{align}$$</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">//例如对于文档 d1,可以得到一个所有单词的权重序列
W1, w2, w3 ...... wn
//然后需要归一化,即
w1 = w1 / sqrt(pow(w1) + pow(w2) + ...... pow(wn))
</code></pre></div><div class="highlight"><pre><code class="language-c" data-lang="c"><span class="cm">/*</span>
<span class="cm"> * 权值归一化</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">get_normalized_power</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">word_power</span><span class="p">,</span> <span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">doc_feature</span><span class="p">,</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">normalized_power</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;!!!!compute normalized_power!!!!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span> <span class="n">power_2</span><span class="p">;</span>   <span class="c1">//docid权重的平方和开根号</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;!!!compute power^2!!!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">iter_doc</span> <span class="o">=</span> <span class="n">doc_feature</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter_doc</span> <span class="o">!=</span> <span class="n">doc_feature</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iter_doc</span><span class="p">)</span>
        <span class="c1">//遍历docid</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">docid</span> <span class="o">=</span> <span class="n">iter_doc</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;docid: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">docid</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">base</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">iter_word</span> <span class="o">=</span> <span class="n">iter_doc</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter_word</span> <span class="o">!=</span> <span class="n">iter_doc</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iter_word</span><span class="p">)</span>
            <span class="c1">//计算分母 sqrt(pow(w1) + pow(w2) + ... + pow(wn))</span>
        <span class="p">{</span>
            <span class="kt">double</span> <span class="n">power</span> <span class="o">=</span> <span class="n">word_power</span><span class="p">[</span><span class="n">iter_word</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">][</span><span class="n">docid</span><span class="p">];</span>
            <span class="n">base</span> <span class="o">+=</span> <span class="p">(</span><span class="n">power</span><span class="o">*</span><span class="n">power</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">power_2</span><span class="p">[</span><span class="n">docid</span><span class="p">]</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">base</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;compute sqrt(power^2) over&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;!!!!compute normalized_power!!!!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">iter_doc</span> <span class="o">=</span> <span class="n">doc_feature</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter_doc</span> <span class="o">!=</span> <span class="n">doc_feature</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iter_doc</span><span class="p">)</span>
        <span class="c1">//遍历docid</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">docid</span> <span class="o">=</span> <span class="n">iter_doc</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">iter_word</span> <span class="o">=</span> <span class="n">iter_doc</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter_word</span> <span class="o">!=</span> <span class="n">iter_doc</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iter_word</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">normalized_power</span><span class="p">[</span><span class="n">iter_word</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">][</span><span class="n">docid</span><span class="p">]</span> <span class="o">=</span> <span class="n">word_power</span><span class="p">[</span><span class="n">iter_word</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">][</span><span class="n">docid</span><span class="p">]</span><span class="o">/</span><span class="n">power_2</span><span class="p">[</span><span class="n">docid</span><span class="p">];</span>
                <span class="c1">//取出分子，与分母相除，计算归一化权重</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;compute over!!!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>第三步，单词索引写入文件：</h2>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">ofstream</span> <span class="nf">ofs_word_index</span><span class="p">(</span><span class="s">&quot;words.index&quot;</span><span class="p">);</span>
    <span class="c1">//写单词索引文件</span>
<span class="k">for</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span> <span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">normalized_power</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter</span> <span class="o">!=</span> <span class="n">normalized_power</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">ofs_word_index</span> <span class="o">&lt;&lt;</span> <span class="n">iter</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">iter</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">iter</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">ofs_word_index</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span>  <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">ofs_word_index</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>第五阶段：计算文本相似度    0518</h2>

<p>&emsp;&emsp;根据公式，计算两篇doc之间的相似度：
$$\begin{align}
sim(doc<em>1, doc</em>2) = {\sum<em>{i\in doc</em>1\cap doc<em>2} ({n\</em>power_doc1<em>{wi} * n\</em>power_doc2_{wi}})}
\end{align}$$ </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">//计算 doc_x, doc_y 之间的相似度
//两篇doc之间的公共单词是 word_1, word_2 ... word_n
sim(doc_x, doc_y) = (wx_1*wy_1 + wx_2*wy_2 + ... + wx_n*wy_n);
</code></pre></div>
<h2>第六阶段：查询模块  0518</h2>

<p>&emsp;&emsp;对输入的查询query进行切词（去停用词），计算出同时包含所有查询词的所有docid：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/* 
 * 求出同时包含不同搜索词的docid,
 * 放入 set&lt;int&gt; common_docid 中 
 */
static void get_common_docid(map&lt;string, map&lt;int, double&gt; &gt; &amp;m_word_index, vector&lt;string&gt; &amp;words, set&lt;int&gt; &amp;common_docid)
{
    if(words.size() &gt;= 1)
    {
        for(map&lt;int, double&gt;::iterator iter = m_word_index[words[0]].begin(); iter != m_word_index[words[0]].end(); ++iter)
        {
            common_docid.insert(iter-&gt;first); 
                //将包含第一个单词的docid全部输入到set&lt;int&gt;中
        }
    }
    if(words.size() &gt; 1)
    {
        for(vector&lt;string&gt;::size_type ix = 1; ix != words.size(); ++ix)
            //从第二个单词开始遍历，查找同时含有搜索关键词的docid
        {
            for(set&lt;int&gt;::iterator iter = common_docid.begin(); iter != common_docid.end(); )
                //遍历set&lt;int&gt;查找该docid是否存包含当前搜索词
                //这里涉及到遍历set并用erase删除元素
                //***需要判断边界！！！！（重要）***//
            {
                set&lt;int&gt;::iterator it_back = iter;  //备份迭代器
                bool is_begin = false;
                if(it_back == common_docid.begin())
                {
                    is_begin = true;
                }
                else
                {
                    it_back --; //备份迭代器
                }

                if(!m_word_index[words[ix]].count(*iter))
                    //set&lt;int&gt;的docid不包含当前搜索词
                {
                    //cout &lt;&lt; &quot;not common &quot; &lt;&lt; *iter &lt;&lt; endl;
                    common_docid.erase(iter);
                        //删除元素（docid）
                    if(is_begin)
                        //如果删除的是begin元素，重置迭代器
                    {
                        iter = common_docid.begin();
                    }
                    else
                    {
                        iter = ++ it_back;
                        //删除元素后重新设置迭代器
                    }
                }
                else
                {
                    iter++;
                }
            }
        }
    }
#ifndef DEBUG   //测试输出包含搜索词的docid
    for(set&lt;int&gt;::iterator iter = common_docid.begin(); iter != common_docid.end(); ++iter)
    {
        cout &lt;&lt; &quot;common_docid: &quot; &lt;&lt; *iter &lt;&lt; endl;;
    }
#endif
}
</code></pre></div>
<p>然后将query当做一篇doc，计算单词的权重，以及归一化权重。
根据公式，计算两篇doc（query和doc）之间的相似度：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/*
 * 计算相似度
 * 求doc与搜索关键字的相似度
 * 结果存入优先级队列
 */
void compute_similarity(set&lt;int&gt; &amp;common_docid, map&lt;string, double&gt; &amp;search_word_normalized_power, map&lt;string, map&lt;int, double&gt; &gt; &amp;word_index, priority_queue&lt;Similarity, vector&lt;Similarity&gt;, compare&gt; &amp;q)
{
        //求相似度
        for(set&lt;int&gt;::iterator iter = common_docid.begin(); iter != common_docid.end(); ++iter)
        {
            int docid = *iter;
            double similarity = 0;
            for(map&lt;string, double&gt;::iterator it = search_word_normalized_power.begin(); it != search_word_normalized_power.end(); ++it)
            {
                similarity += it-&gt;second * word_index[it-&gt;first][docid];
            }
            Similarity sim;
            sim._docid = docid;
            sim._similarity = similarity;
            q.push(sim);
        }
}
</code></pre></div>
<p>从计算得到的docid取出整篇doc，分别取出标题和内容:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">std::string Task::get_title(const std::string &amp;doc) //取标题
{
    int start = doc.find(&quot;&lt;title&gt;&quot;) + 7;
    int end = doc.find(&quot;&lt;/title&gt;&quot;);
    string title(doc, start, end - start);
    if(title[0] == &#39;\n&#39;)
    {
        title.erase(0, 1);
    }
    return title;
}
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">std::string Task::get_content(const std::string &amp;doc)   //取内容
{
    int start = doc.find(&quot;&lt;content&gt;&quot;) + 9;
    int end = doc.find(&quot;&lt;/content&gt;&quot;);
    string content(doc, start, end - start);
    if(content[0] == &#39;\n&#39;)
    {
        content.erase(0, 1);
    }
    string line;
    istringstream iss(content);
    int count = m_out_line;
    string ret;
    while(getline(iss, line) &amp;&amp; count &gt; 0)
    {
        ret += line + &quot;&lt;br&gt;&quot;;   //html的换行模式
        count--;
    }
    ret += &quot;......&quot;;
    return ret;
}
</code></pre></div>
<p>将查询结果制作成 Jason 字符串，发回客户端（前台页面）：</p>
<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="cm">/* </span>
<span class="cm"> * 将一个vector&lt;pair&lt;string,string&gt; &gt;做成json字符串 </span>
<span class="cm"> * pair中存放两个string，分别是title和content</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">json_string</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">result_pair</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Json</span><span class="o">::</span><span class="n">Value</span> <span class="n">root</span> <span class="p">;</span>
    <span class="n">Json</span><span class="o">::</span><span class="n">Value</span> <span class="n">arr</span> <span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span> <span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">result_pair</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter</span> <span class="o">!=</span> <span class="n">result_pair</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Json</span><span class="o">::</span><span class="n">Value</span> <span class="n">elem</span> <span class="p">;</span>
        <span class="n">elem</span><span class="p">[</span><span class="s">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iter</span><span class="o">-&gt;</span><span class="n">first</span> <span class="p">;</span>
        <span class="n">elem</span><span class="p">[</span><span class="s">&quot;summary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iter</span><span class="o">-&gt;</span><span class="n">second</span> <span class="p">;</span>
        <span class="n">arr</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">root</span><span class="p">[</span><span class="s">&quot;files&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">arr</span> <span class="p">;</span>
    <span class="n">Json</span><span class="o">::</span><span class="n">FastWriter</span> <span class="n">writer</span> <span class="p">;</span>
    <span class="n">Json</span><span class="o">::</span><span class="n">StyledWriter</span> <span class="n">stlwriter</span> <span class="p">;</span>
    <span class="k">return</span> <span class="n">stlwriter</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h2>第七阶段：前台页面</h2>

<p>&emsp;&emsp;index.html 使用 javascript 通过 post 方法向 php 写的 tcp_client 发送查询 query，并将接收到的查询结果（Jason字符串）解析出来后显示在页面上：</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script&gt;</span>
<span class="c1">//点击search按钮，执行其中的事件，注意js代码的注释与html代码的注释的区别</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#submitButton&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

    <span class="c1">//取输入框的值</span>
    <span class="kd">var</span> <span class="nx">myWords</span><span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#txtSearch&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="c1">//ajax请求，方法为post,php客户端返回的数据（echo）存在data变量中</span>
 <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&quot;tcp_client.php&quot;</span><span class="p">,{</span><span class="nx">content</span><span class="o">:</span><span class="nx">myWords</span><span class="p">},</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="nx">status</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">status</span><span class="o">==</span><span class="s2">&quot;success&quot;</span><span class="p">)</span><span class="c1">//post请求状态成功</span>
    <span class="p">{</span>      
    <span class="c1">//将收到的json字符串（data）转化为json对象，注意json字符串与json对象的区别</span>
        <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nx">data</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">);</span> 
       <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#result&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span><span class="c1">//清空result内容,用的是jquery的html()函数</span>
     <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">files</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span><span class="c1">//遍历json对象，用的是jquery的each()方法，该json对象的格式近似于：{&quot;files&quot;:[{&quot;title&quot;:title_1,&quot;summary&quot;:summary_1}，...................]}</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#result&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="c1">//将遍历到的数据显示在id为result这个div里面</span>
                           <span class="c1">//根据json对象的每一个子集的键显示相应的值，哟给你的是json的语法</span>
                            <span class="s2">&quot;&lt;div&gt;&quot;</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">title</span>  <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;&lt;div&gt;&quot;</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">summary</span><span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&lt;hr/&gt;&quot;</span><span class="p">);</span>
                <span class="p">});</span>

    <span class="p">}</span>
    <span class="k">else</span> <span class="c1">//post failure</span>
    <span class="p">{</span>

        <span class="nx">alert</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span> 

 <span class="p">});</span>  <span class="c1">//end post</span>

    <span class="p">});</span>    

<span class="nt">&lt;/script&gt;</span><span class="c">&lt;!--  javascript 结束 --&gt;</span>
</code></pre></div>
<p>&emsp;&emsp;<code>php</code> 客户端，主要功能是，当用户提交查询时，使用 tcp 协议向服务器发送查询词，并接收服务器发回的查询结果：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;?php 
$buff=$_REQUEST[&quot;content&quot;];//采用$_REQUEST超全局数组来接收index.html页面post请求传递过来的数据
//tcp  client 
$server_Ip=&quot;127.0.0.1&quot;;//服务端ip地址，如果你的客户端与服务端不在同一台电脑，请修改该ip地址
$server_Port=5080;//通信端口号

//设置超时时间
set_time_limit(0);
//创建套接字
 $sock= socket_create(AF_INET,SOCK_STREAM,SOL_TCP);
if(!$sock)
{
    echo &quot;creat sock failed&quot;;
    exit();//创建套接字失败，结束程序
}

socket_connect($sock,$server_Ip,$server_Port);

//发送数据到tcp的服务端（C语言写的）
socket_send($sock,$buff,strlen($buff),0);
$buff=&quot;&quot;;//清空缓冲区
socket_recv($sock,$buff,1024000,0);//接收tcp_server传递过来json字符串，存在变量$buff中

echo trim($buff).&quot;\n&quot;;//去掉接受到的字符串的首尾空格，返回给post请求的data
//关闭套接字
socket_close($sock);
?&gt;
</code></pre></div>
    </div>
    <hr>
    <div id="disqus_thread">
  <button type="button" name="liuwenyu" class="btn btn-default show-commend">显示评论</button>
</div>

  </div>
  <!-- 目录 -->
  <div id="content_table" style="position:fixed;right:20px;top:120px;display:none;">
    <div class="panel panel-success">
      <div class="panel-body" id="nav"></div>
    </div>
  </div>
</div>


          </div>
        </div>
      </div>
    </div>
  </div>
  <div style="position:fixed;right:20px;top:10px;">
  <button id="nav_btn" class="btn btn-lg" style="height:45px;width:45px;"><i class="fa fa-angle-left"></i></button>
</div>
<div style="position:fixed;right:20px;top:60px;">
  <button id="content_btn" class="btn btn-lg" style="height:45px;width:45px;"><i class="fa fa-angle-down"></i></button>
</div>
<script type="text/javascript" src="/public/js/jquery.js"></script>
<script type="text/javascript" src="/public/js/bootstrap.js"></script>
<script src="/public/js/jquery.pjax.js"></script>
<script src="/public/js/prettify/prettify.js"></script>
<script>
    $('a[href="#学习"]').tab('show');
</script>
<script src="/public/js/base.js"></script>
 
</body>
</html>
